<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Send Notifications - Kingsley Carwash</title>

    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />

    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <!-- ========== Sidebar ========== -->
      <aside>
        <div class="sidebar-top">
          <a href="index.html" class="logo">
            <img
              src="./images/minimalkingsley.png"
              alt="Kingsley Carwash Logo"
            />
          </a>
          <div class="sidebar-close" id="close-btn">
            <span class="material-symbols-outlined">close</span>
          </div>
        </div>

        <div class="sidebar-menu">
          <a href="index.html">
            <span class="material-symbols-outlined">dashboard</span>
            <h3>Dashboard</h3>
          </a>
          <a href="appointment.html">
            <span class="material-symbols-outlined">book_online</span>
            <h3>Appointments</h3>
          </a>
          <a href="technicians.html">
            <span class="material-symbols-outlined">engineering</span>
            <h3>Technicians</h3>
          </a>
          <a href="customers.html">
            <span class="material-symbols-outlined">groups</span>
            <h3>Customers</h3>
          </a>
          <a href="services.html">
            <span class="material-symbols-outlined">local_car_wash</span>
            <h3>Services & Pricing</h3>
          </a>
          <a href="promotions.html">
            <span class="material-symbols-outlined">campaign</span>
            <h3>Promotions</h3>
          </a>
          <a href="media-manager.html">
            <span class="material-symbols-outlined">perm_media</span>
            <h3>Media Manager</h3>
          </a>
          <a href="sales.html">
            <span class="material-symbols-outlined">trending_up</span>
            <h3>Sales</h3>
          </a>
          <a href="reviews.html">
            <span class="material-symbols-outlined">reviews</span>
            <h3>Reviews</h3>
          </a>
          <a href="payment-monitoring.html">
            <span class="material-symbols-outlined">payment</span>
            <h3>Payment Monitoring</h3>
          </a>
          <a href="geofencing.html">
            <span class="material-symbols-outlined">location_on</span>
            <h3>Geofencing</h3>
          </a>
          
        </div>
      </aside>
      <!-- ========== End of Sidebar ========== -->

      <!-- ========== Main Content ========== -->
      <main>
        <!-- ========== Header ========== -->
        <header class="main-header">
          <button id="menu-btn">
            <span class="material-symbols-outlined">menu</span>
          </button>
          <h1>Send Notifications</h1>
          <div class="header-right">
            <div class="theme-toggler">
              <span class="material-symbols-outlined active">light_mode</span>
              <span class="material-symbols-outlined">dark_mode</span>
            </div>
            <div class="notification-bell">
              <span class="material-symbols-outlined">notifications</span>
              <span class="message-count">5</span>
              <div class="notification-dropdown">
                <div class="notification-list-dropdown">
                  <!-- Notification items will be injected here by JS -->
                  <p style="padding: 1rem; text-align: center">
                    No new notifications.
                  </p>
                </div>
                <a href="notifications.html" class="notification-footer">
                  View All Notifications
                </a>
              </div>
            </div>
            <a
              href="chats.html"
              class="header-action-btn"
              id="chat-icon-btn"
              title="Customer Chats"
            >
              <span class="material-symbols-outlined">forum</span>
              <span
                class="message-count"
                id="chat-message-count"
                style="display: none"
                >0</span
              >
            </a>
            <a
              href="todo-lists.html"
              class="header-action-btn"
              title="To-Do List"
            >
              <span class="material-symbols-outlined"
                >format_list_bulleted</span
              >
            </a>
            <div class="profile">
              <div class="info">
                <p>Hey, <b id="profile-header-name">Admin</b>!</p>
                <small>Admin Portal</small>
              </div>
              <div class="profile-photo">
                <img src="./images/adam.jpg" alt="Admin Profile" />
              </div>
            </div>
          </div>
        </header>
        <!-- ========== End of Header ========== -->

        <!-- ========== Main Content ========== -->
        <div class="right">
          <!-- Send Notification Form -->
          <div class="send-notification-container">
            <h2>Send Notification to Users</h2>

            <!-- Notification Type Selection -->
            <div class="notification-type-selector">
              <label>Notification Target:</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input
                    type="radio"
                    name="notification-target"
                    value="single"
                    checked
                  />
                  <span>Send to Single User</span>
                </label>
                <label class="radio-label">
                  <input
                    type="radio"
                    name="notification-target"
                    value="multiple"
                  />
                  <span>Send to Multiple Users</span>
                </label>
                <label class="radio-label">
                  <input
                    type="radio"
                    name="notification-target"
                    value="all"
                  />
                  <span>Send to All Users</span>
                </label>
              </div>
            </div>

            <!-- Form -->
            <form id="send-notification-form" class="notification-form">
              <!-- Single User Selection -->
              <div id="single-user-section" class="form-section">
                <label for="user-select">Select User:</label>
                <div class="search-user-container">
                  <input
                    type="text"
                    id="user-search"
                    placeholder="Search user by name or email..."
                    class="form-input"
                  />
                  <select
                    id="user-select"
                    class="form-input"
                    required
                  >
                    <option value="">-- Select a user --</option>
                  </select>
                </div>
                <small id="selected-user-info" class="form-help-text"></small>
              </div>

              <!-- Notification Category -->
              <div class="form-section">
                <label for="notification-category">Notification Category:</label>
                <select id="notification-category" class="form-input" required>
                  <option value="">-- Select category --</option>
                  <option value="appointment">Appointment Update</option>
                  <option value="promotion">Promotion</option>
                  <option value="payment">Payment Confirmation</option>
                  <option value="service">Service Update</option>
                  <option value="general">General Announcement</option>
                  <option value="reminder">Reminder</option>
                  <option value="custom">Custom</option>
                </select>
              </div>

              <!-- Notification Title -->
              <div class="form-section">
                <label for="notification-title">Title:</label>
                <input
                  type="text"
                  id="notification-title"
                  class="form-input"
                  placeholder="e.g., Appointment Confirmed"
                  required
                />
              </div>

              <!-- Notification Message -->
              <div class="form-section">
                <label for="notification-message">Message:</label>
                <textarea
                  id="notification-message"
                  class="form-textarea"
                  placeholder="Enter the notification message..."
                  rows="4"
                  required
                ></textarea>
                <small class="char-count">
                  <span id="char-count">0</span>/500 characters
                </small>
              </div>

              <!-- Image URL (Optional) -->
              <div class="form-section">
                <label for="notification-image">Image URL (Optional):</label>
                <input
                  type="url"
                  id="notification-image"
                  class="form-input"
                  placeholder="https://example.com/image.jpg"
                />
                <div id="image-preview" style="display: none; margin-top: 1rem">
                  <img
                    id="image-preview-img"
                    style="max-width: 200px; max-height: 200px; border-radius: 8px"
                    alt="Image preview"
                  />
                </div>
              </div>

              <!-- Additional Data (Optional) -->
              <div class="form-section">
                <label for="notification-data"
                  >Additional Data (JSON, Optional):</label
                >
                <textarea
                  id="notification-data"
                  class="form-textarea"
                  placeholder='e.g., {"appointmentId": "123", "link": "/appointment-details"}'
                  rows="3"
                ></textarea>
              </div>

              <!-- Action Buttons -->
              <div class="form-actions">
                <button
                  type="button"
                  id="preview-btn"
                  class="btn-secondary"
                >
                  <span class="material-symbols-outlined">preview</span>
                  Preview
                </button>
                <button
                  type="submit"
                  id="send-btn"
                  class="btn-primary"
                  disabled
                >
                  <span class="material-symbols-outlined">send</span>
                  Send Notification
                </button>
              </div>

              <!-- Loading & Status -->
              <div id="status-message" class="status-message hidden"></div>
            </form>
          </div>

          <!-- Recent Sent Notifications -->
          <div class="recent-notifications-container" style="margin-top: 3rem">
            <h2>Recently Sent Notifications</h2>
            <div id="recent-notifications-list" class="notifications-list">
              <p class="placeholder-text">Loading recent notifications...</p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Notification Preview</h3>
          <button class="modal-close" id="preview-close-btn">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="notification-preview">
            <div class="preview-item">
              <div class="preview-title" id="preview-title"></div>
              <div class="preview-message" id="preview-message"></div>
              <div id="preview-image-section" style="display: none">
                <img
                  id="preview-image"
                  style="max-width: 100%; max-height: 300px; border-radius: 8px; margin-top: 1rem"
                  alt="Notification image"
                />
              </div>
              <div class="preview-metadata">
                <small id="preview-timestamp"></small>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" id="preview-confirm-btn" class="btn-primary">
            Proceed to Send
          </button>
          <button type="button" class="btn-secondary" id="preview-cancel-btn">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Initialize Firebase (must load first as ES module) -->
    <script type="module">
      import('./firebase-setup.js').then(() => {
        // Firebase is now ready, load auth guard
        const script = document.createElement('script');
        script.src = 'auth-guard.js';
        document.body.appendChild(script);
        
        // Load notification script after auth guard
        const notifScript = document.createElement('script');
        notifScript.src = 'send-notification.js';
        notifScript.onload = () => console.log('Send notification script loaded');
        document.body.appendChild(notifScript);
      }).catch(err => {
        console.error('Failed to initialize Firebase:', err);
      });
    </script>
  </body>
</html>
